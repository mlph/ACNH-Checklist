<mat-toolbar>
    <mat-checkbox *ngFor="let s of settings.itemskey" [(ngModel)]="settings.items[s]" (change)="TableColumns()">{{s}}
    </mat-checkbox>
    <!-- <mat-checkbox [(ngModel)]="settings.items.image" (ngModelChange)="settings.settingChanged.next({prop:'showimage',data:settings.showimage})">image</mat-checkbox>
    <mat-checkbox [(ngModel)]="settings.items.data" (ngModelChange)="settings.settingChanged.next({prop:'showdata',data:settings.showdata})">data</mat-checkbox>
    <mat-checkbox [(ngModel)]="settings.items.variants" (ngModelChange)="settings.settingChanged.next({prop:'showVariations',data:settings.showVariations})">variations</mat-checkbox> -->
</mat-toolbar>
<mat-form-field>
    <input matInput [(ngModel)]="page" type="number" (change)="Filter()">
</mat-form-field>
<mat-form-field>
    <input matInput [(ngModel)]="row" type="number" (change)="Filter()">
</mat-form-field>
<mat-checkbox [(ngModel)]="catalogForSale" (change)="Filter()">購入可のみ</mat-checkbox>
<button mat-button (click)="ToggleState(diystate, diy)">{{diy.state}}</button>

{{(page - 1) * row + 1}} - {{(page - 1) * row + showingData.length}} / {{filteredData.length}} / {{raw.length}}

<div>
    <mat-form-field>
        <input matInput [(ngModel)]="search" (change)="Filter()">
        <button mat-icon-button matSuffix (click)="search = '';Filter()">
            <mat-icon>close</mat-icon>
        </button>
    </mat-form-field>
</div>

<div>
    <button mat-icon-button (click)="CategoryAll(categories1)">
        <mat-icon>weekend</mat-icon>
    </button>
    <button mat-raised-button *ngFor="let c of categories1" (click)="CategoryButton(c)"
        [class.active]="c.checked">{{c.name}}</button>
</div>
<div>
    <button mat-icon-button (click)="CategoryAll(categories2)">
        <mat-icon>checkroom</mat-icon>
    </button>
    <button mat-raised-button *ngFor="let c of categories2" (click)="CategoryButton(c)"
        [class.active]="c.checked">{{c.name}}</button>
</div>
<div>
    <button mat-icon-button (click)="CategoryAll(categories3)">
        <mat-icon>music_note</mat-icon>
    </button>
    <button mat-raised-button *ngFor="let c of categories3" (click)="CategoryButton(c)"
        [class.active]="c.checked">{{c.name}}</button>
</div>


<!-- <table matSort (matSortChange)="ReSort($event)" matSortActive="name" matSortDirection="asc">
    <tr>
        <th mat-sort-header="name" disableClear>なまえ</th>
        <th *ngIf="settings.show.image">がぞう</th>
        <th mat-sort-header="source" disableClear>入手手段</th>
        <th mat-sort-header="catalog" disableClear>カタログ</th>
    </tr>
    <tr *ngFor="let r of showingData">
        <td>{{r.translations?.japanese}}</td>
        <td *ngIf="settings.show.image"><img [src]="r.image"></td>
        <td>
            <span *ngFor="let s of r.source;let i = index">{{t.ItemsSource(s)}}<ng-container
                    *ngIf="IsNotLast(i, r.source)"> , </ng-container></span>
            <button mat-icon-button [matMenuTriggerFor]="menu" *ngIf="r.sourceNotes">
                <mat-icon>speaker_notes</mat-icon>
            </button>
            <mat-menu #menu="matMenu">{{r.sourceNotes}}</mat-menu>
        </td>
        <td>{{t.Catalog(r.catalog)}}</td>
    </tr>
</table> -->

<table mat-table [dataSource]="showingData" matSort (matSortChange)="ReSort($event)" matSortActive="name"
    matSortDirection="asc">
    <ng-container *ngFor="let c of colDataSimple" [matColumnDef]="c.id">
        <ng-container *ngIf="c.sort;else nosort">
            <th [class]="['h_'+c.id]" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>{{c.header}}</th>
        </ng-container>
        <ng-template #nosort>
            <th [class]="['h_'+c.id]" mat-header-cell *matHeaderCellDef>{{c.header}}</th>
        </ng-template>
        <td mat-cell *matCellDef="let element"> {{c.data(element)}} </td>
    </ng-container>

    <ng-container [matColumnDef]="colData.image.id">
        <th class="h_image" mat-header-cell *matHeaderCellDef>がぞう</th>
        <td mat-cell *matCellDef="let element">
            <div class="image">
                <div *ngFor="let s of colData.image.data(element)">
                    <div class="image-name">{{s.name}} </div>
                    <img [src]="s.src" [id]="s.name">
                </div>
            </div>
        </td>
    </ng-container>
    <!-- <ng-container [matColumnDef]="colData.var.id">
        <th class="h_var" mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element">
            <mat-icon *ngIf="colData.var.exist(element)">edit</mat-icon>
        </td>
    </ng-container> -->
    <ng-container [matColumnDef]="colData.source.id">
        <th class="h_source" mat-header-cell *matHeaderCellDef mat-sort-header disableClear>入手手段</th>
        <td class="d_source" mat-cell *matCellDef="let element">
            <div>
                <div>
                    <div *ngFor="let s of element.source;let i = index">{{t.ItemsSource(s)}}<ng-container
                            *ngIf="IsNotLast(i, element.source)"> , </ng-container>
                    </div>
                </div>
                <button mat-icon-button [matMenuTriggerFor]="menu" *ngIf="element.sourceNotes">
                    <mat-icon>speaker_notes</mat-icon>
                </button>
                <mat-menu #menu="matMenu">{{element.sourceNotes}}</mat-menu>
            </div>
        </td>
    </ng-container>
    <ng-container [matColumnDef]="colData.variations.id">
        <th class="h_variations" mat-header-cell *matHeaderCellDef>バリエーション</th>
        <td class="d_variations" mat-cell *matCellDef="let element">
            <div>
                <ng-container *ngIf="!element.variations;else vari">
                    <button mat-icon-button (click)="colData.check.checked(element)">
                        <mat-icon>{{colData.check.icon(element)}}</mat-icon>
                    </button>
                </ng-container>
                <ng-template #vari>
                    <ng-container *ngFor="let s of element.variations;let i = index">
                        <div>
                            <mat-checkbox [checked]="colData.variations.isChecked(element, s)"
                                (change)="colData.variations.check(element, s)">{{colData.variations.ja(s)}}
                            </mat-checkbox>
                            <!-- <ng-container *ngIf="IsNotLast(i, element.variations)">,</ng-container> -->
                        </div>
                    </ng-container>
                </ng-template>
            </div>
        </td>
    </ng-container>
    <ng-container [matColumnDef]="colData.check.id">
        <th class="h_checked" mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let element" (click)="colData.check.checked(element)">
            <button mat-icon-button>
                <mat-icon>{{colData.check.icon(element)}}</mat-icon>
            </button>
        </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="col"></tr>
    <tr mat-row *matRowDef="let row; columns: col;"></tr>
</table>